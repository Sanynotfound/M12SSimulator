<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜¿å¡ç‹„äºšç™»å¤©æ–—æŠ€åœºé‡é‡çº§4 æ–‡å­—æ¨¡æ‹Ÿå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #f5f5f7;
            color: #1d1d1f;
            -webkit-font-smoothing: antialiased;
        }

        .card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        /* æŒ‰é’®åŸºç¡€æ ·å¼ */
        .btn {
            background-color: #0071e3;
            color: white;
            border-radius: 980px;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: none;
            cursor: pointer;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden; /* ç¡®ä¿è¿›åº¦æ¡ä¸æº¢å‡º */
            z-index: 1;
        }

        .btn:hover {
            background-color: #0077ed;
            transform: scale(1.01);
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background-color: #e8e8ed;
            color: #1d1d1f;
        }

        .btn-secondary:hover {
            background-color: #d2d2d7;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #d2d2d7;
            color: #1d1d1f;
        }
        .btn-outline:hover {
            background-color: #f5f5f7;
            border-color: #0071e3;
            color: #0071e3;
        }

        /* å€’è®¡æ—¶åŠ¨ç”»æ¡ */
        .timer-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.15); /* æŒ‰é’®æ–‡å­—ä¸ºç™½è‰²ï¼Œæ·±è‰²é®ç½©è¡¨ç¤ºå€’è®¡æ—¶ */
            z-index: -1;
            width: 100%;
            transform-origin: left;
        }

        .timer-10s {
            animation: timerShrink 10s linear forwards;
        }

        .timer-5s {
            animation: timerShrink 5s linear forwards;
        }

        @keyframes timerShrink {
            from { transform: scaleX(1); }
            to { transform: scaleX(0); }
        }

        .highlight {
            color: #0071e3;
            font-weight: 700;
        }

        .danger {
            color: #ff3b30;
            font-weight: 700;
        }

        .purple {
            color: #af52de;
            font-weight: 700;
        }
        
        .phase-indicator {
            height: 4px;
            border-radius: 2px;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-box {
            background-color: #f5f5f7;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .copyright {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
            text-align: center;
            font-size: 0.75rem;
            color: #86868b;
        }
        
        /* ç¬”è®°å¡ç‰‡æ ·å¼ */
        .note-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-md mx-auto">
        </div>

    <script>
        // --- æ ¸å¿ƒé€»è¾‘æ•°æ® ---

        const ROLES = ['A', '1', 'B', '2', 'C', '3', 'D', '4'];
        
        // å½±å­åˆ·æ–°æ¬¡åº
        const SHADOW_ORDERS = [
            { id: 'card_first', text: 'å…ˆæ­£ç‚¹ï¼Œåæ–œç‚¹' },
            { id: 'inter_first', text: 'å…ˆæ–œç‚¹ï¼Œåæ­£ç‚¹' }
        ];

        // åˆå§‹å°æ€ªé¢„å…† (2)
        const INITIAL_ADDS = [
            { id: 'A_LR_C_UD', text: 'Aç‚¹å·¦å³åˆ€ï¼ŒCç‚¹ä¸Šä¸‹åˆ€' },
            { id: 'A_UD_C_LR', text: 'Aç‚¹ä¸Šä¸‹åˆ€ï¼ŒCç‚¹å·¦å³åˆ€' }
        ];

        // å°æ€ªç‚¹åç±»å‹ (3)
        const ADD_TETHER_TYPES = [
            { id: 'card_stack', text: 'æ­£ç‚¹åˆ†æ‘Šï¼Œæ–œç‚¹å¤§åœˆ' }, 
            { id: 'card_spread', text: 'æ­£ç‚¹å¤§åœˆï¼Œæ–œç‚¹åˆ†æ‘Š' } 
        ];

        // å¡”çš„æ•°æ®ç”Ÿæˆé€»è¾‘
        const SPECIAL_TOWERS = ['é£', 'æš—'];
        const NORMAL_TOWERS = ['åœŸ', 'ç«'];

        // å°æ€ªé»‘æ´/è·³è·ƒ (8)
        const SECOND_ADD_JUMPS = [
            { id: 'SuckA_JumpB', text: 'å¸Aï¼ŒCç‚¹å°æ€ªè·³B' },
            { id: 'SuckA_JumpD', text: 'å¸Aï¼ŒCç‚¹å°æ€ªè·³D' },
            { id: 'SuckC_JumpB', text: 'å¸Cï¼ŒAç‚¹å°æ€ªè·³B' },
            { id: 'SuckC_JumpD', text: 'å¸Cï¼ŒAç‚¹å°æ€ªè·³D' }
        ];

        // --- æ¸¸æˆçŠ¶æ€ç®¡ç† ---

        let timerInterval = null;

        const state = {
            step: 0, // 0:é¦–é¡µ, 1-10:é¢˜ç›®, 11:èƒœåˆ©, 99:å›¢ç­(é™æ—¶æ¨¡å¼), -1:ç¬”è®°
            scenario: {},
            showAnswer: false,
            mode: 'practice' // 'practice' | 'timeAttack'
        };

        function initScenario(mode = 'practice') {
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            clearTimer();

            state.mode = mode;

            // åŸºç¡€éšæœº
            const role = ROLES[Math.floor(Math.random() * ROLES.length)];
            const shadowOrder = SHADOW_ORDERS[Math.floor(Math.random() * SHADOW_ORDERS.length)];
            const initialAdds = INITIAL_ADDS[Math.floor(Math.random() * INITIAL_ADDS.length)];
            const tetherType = ADD_TETHER_TYPES[Math.floor(Math.random() * ADD_TETHER_TYPES.length)];
            const secondAddJump = SECOND_ADD_JUMPS[Math.floor(Math.random() * SECOND_ADD_JUMPS.length)];

            // å¡”é€»è¾‘ç”Ÿæˆ
            const special = SPECIAL_TOWERS[Math.floor(Math.random() * SPECIAL_TOWERS.length)];
            const normal = NORMAL_TOWERS[Math.floor(Math.random() * NORMAL_TOWERS.length)];
            
            // å†³å®šç©å®¶åˆå§‹æ˜¯åœ¨ç‰¹æ®Šå¡”è¿˜æ˜¯æ™®é€šå¡”
            const isUserAtSpecial = Math.random() < 0.5;
            const myInitTower = isUserAtSpecial ? special : normal;
            const neighborTower = isUserAtSpecial ? normal : special;

            // å†³å®šè¿™ä¸€è¡Œè°æœ‰ç‚¹å (Debuff)
            const userHasDebuff = Math.random() < 0.5;
            
            // è®¡ç®—æœ€ç»ˆå¤„ç†çš„å¡”
            let swap = false;
            let finalTower = myInitTower;

            if (isUserAtSpecial) { // æˆ‘åˆå§‹åœ¨é£/æš—
                if (userHasDebuff) {
                    swap = true; // æˆ‘æœ‰debuffï¼Œä¸èƒ½å¤„ç†é£/æš—ï¼Œè¦å»æ¢é˜Ÿå‹çš„åœŸ/ç«
                    finalTower = neighborTower;
                } else {
                    swap = false; // æˆ‘æ²¡debuffï¼Œé˜Ÿå‹æœ‰debuffåœ¨åœŸ/ç«ï¼Œå¤§å®¶éƒ½ä¸åŠ¨
                    finalTower = myInitTower;
                }
            } else { // æˆ‘åˆå§‹åœ¨åœŸ/ç«
                if (userHasDebuff) {
                    swap = false; // æˆ‘æœ‰debuffï¼Œåœ¨åœŸ/ç«å¾ˆå®‰å…¨ï¼Œä¸åŠ¨
                    finalTower = myInitTower;
                } else {
                    swap = true; // æˆ‘æ²¡debuffï¼Œæ„å‘³ç€é˜Ÿå‹åœ¨é£/æš—ä¸”æœ‰debuffï¼Œä»–è¦è¿‡æ¥ï¼Œæˆ‘è¦è¿‡å»
                    finalTower = neighborTower;
                }
            }

            state.scenario = {
                role,
                shadowOrder,
                initialAdds,
                tetherType,
                secondAddJump,
                tower: {
                    myInit: myInitTower,
                    neighbor: neighborTower,
                    hasDebuff: userHasDebuff,
                    shouldSwap: swap,
                    final: finalTower
                }
            };
            state.step = 1;
            state.showAnswer = false;
            render();

            // å¦‚æœæ˜¯é™æ—¶æ¨¡å¼ï¼Œå¼€å§‹ç¬¬ä¸€é¢˜å€’è®¡æ—¶
            if (state.mode === 'timeAttack') {
                startQuestionTimer();
            }
        }

        function showNotes() {
            state.step = -1;
            render();
        }

        function nextStep() {
            clearTimer();
            state.step++;
            state.showAnswer = false;
            render();
            
            // é™æ—¶æ¨¡å¼é€»è¾‘
            if (state.step <= 10 && state.mode === 'timeAttack') {
                startQuestionTimer();
            }
        }

        function toggleAnswer() {
            // é™æ—¶æ¨¡å¼ä¸‹ï¼Œå¿…é¡»åœ¨å€’è®¡æ—¶ç»“æŸå‰ç‚¹å‡»
            if (state.mode === 'timeAttack') {
                clearTimer(); // åœæ­¢æ€è€ƒå€’è®¡æ—¶
            }

            state.showAnswer = !state.showAnswer;
            render();

            // é™æ—¶æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºç­”æ¡ˆ5ç§’åè‡ªåŠ¨è·³è½¬
            if (state.mode === 'timeAttack' && state.showAnswer) {
                startAnswerTimer();
            }
        }

        function restart() {
            clearTimer();
            state.step = 0;
            state.showAnswer = false;
            state.mode = 'practice';
            render();
        }

        // --- é™æ—¶æ¨¡å¼ å®šæ—¶å™¨é€»è¾‘ ---
        
        function clearTimer() {
            if (timerInterval) {
                clearTimeout(timerInterval);
                timerInterval = null;
            }
        }

        function startQuestionTimer() {
            clearTimer();
            // 10ç§’åå›¢ç­
            timerInterval = setTimeout(() => {
                triggerGameOver();
            }, 10000);
        }

        function startAnswerTimer() {
            clearTimer();
            // 5ç§’åä¸‹ä¸€é¢˜
            timerInterval = setTimeout(() => {
                if (state.step === 10) {
                    nextStep(); // å»ç»“ç®—é¡µ
                } else {
                    nextStep();
                }
            }, 5000);
        }

        function triggerGameOver() {
            clearTimer();
            state.step = 99; // å›¢ç­çŠ¶æ€ç 
            render();
        }


        // --- é€»è¾‘è®¡ç®—å‡½æ•° ---
        // (ä¿æŒåŸæœ‰çš„é€»è¾‘è®¡ç®—å‡½æ•°ä¸å˜)

        function getQ1Answer(s) {
            const isCardStack = s.tetherType.id === 'card_stack';
            const logicMap = {
                'A': { start: 'A', type: 'å¤§åœˆ', idx: 1 },
                '1': { start: 'A', type: 'å¤§åœˆ', idx: 2 },
                'B': { start: 'A', type: 'åˆ†æ‘Š', idx: 1 },
                '2': { start: 'A', type: 'åˆ†æ‘Š', idx: 2 },
                'C': { start: 'C', type: 'åˆ†æ‘Š', idx: 1 },
                '3': { start: 'C', type: 'åˆ†æ‘Š', idx: 2 },
                'D': { start: 'C', type: 'å¤§åœˆ', idx: 1 },
                '4': { start: 'C', type: 'å¤§åœˆ', idx: 2 },
            };
            const userLogic = logicMap[s.role];
            const points = ['A', '1', 'B', '2', 'C', '3', 'D', '4'];
            const types = points.map(p => {
                const isCard = ['A', 'B', 'C', 'D'].includes(p);
                if (isCardStack) return isCard ? 'åˆ†æ‘Š' : 'å¤§åœˆ';
                else return isCard ? 'å¤§åœˆ' : 'åˆ†æ‘Š';
            });
            let startIndex = points.indexOf(userLogic.start);
            let count = 0;
            let targetPoint = '';
            for (let i = 0; i < 8; i++) {
                let currIdx = (startIndex + i) % 8;
                if (types[currIdx] === userLogic.type) {
                    count++;
                    if (count === userLogic.idx) {
                        targetPoint = points[currIdx];
                        break;
                    }
                }
            }
            return `ä½ éœ€è¦å»æ¥ <span class="highlight">${targetPoint}ç‚¹</span> çš„ <span class="highlight">${userLogic.type}</span> çº¿ã€‚`;
        }

        function getQ2Answer(s) {
            if (s.initialAdds.id === 'A_LR_C_UD') return 'å®‰å…¨åŒºåœ¨ <span class="highlight">2ç‚¹ æˆ– 3ç‚¹</span> çš„å¤–ä¾§ã€‚';
            return 'å®‰å…¨åŒºåœ¨ <span class="highlight">1ç‚¹ æˆ– 4ç‚¹</span> çš„å¤–ä¾§ã€‚';
        }

        function getQ3Answer(s) {
            if (s.tower.shouldSwap) {
                return `éœ€è¦<span class="danger">æ¢å¡”</span>ã€‚ç¨åå¤„ç†éš”å£çš„ <span class="highlight">${s.tower.final}å¡”</span>ã€‚`;
            } else {
                return `<span class="highlight">ä¸éœ€è¦æ¢å¡”</span>ã€‚ç¨åå¤„ç†è‡ªå·±çš„ <span class="highlight">${s.tower.final}å¡”</span>ã€‚`;
            }
        }

        function getQ4Answer(s) {
            const map = {
                'A': '1ç‚¹å¤§åœˆ &rarr; 2ç‚¹åˆ†æ‘Š',
                '1': '2ç‚¹åˆ†æ‘Š &rarr; 1ç‚¹å¤§åœˆ',
                'B': '2ç‚¹åˆ†æ‘Š &rarr; 2ç‚¹åˆ†æ‘Š',
                '2': '2ç‚¹åˆ†æ‘Š &rarr; 2ç‚¹åˆ†æ‘Š',
                'C': '3ç‚¹åˆ†æ‘Š &rarr; 3ç‚¹åˆ†æ‘Š',
                '3': '3ç‚¹åˆ†æ‘Š &rarr; 3ç‚¹åˆ†æ‘Š',
                'D': '4ç‚¹å¤§åœˆ &rarr; 3ç‚¹åˆ†æ‘Š',
                '4': '3ç‚¹åˆ†æ‘Š &rarr; 4ç‚¹å¤§åœˆ'
            };
            return map[s.role];
        }

        function getQ5Answer(s) {
            const t = s.tower.final;
            let mech = '';
            let tetherLogic = '';
            if (t === 'é£') {
                mech = 'ç«™åœ¨å¡”é è¿‘åœºä¸­çš„è¾¹ç¼˜ï¼Œè¢«å‡»é£è‡³å¯¹é¢ï¼Œèº²é¿çŸ³ç¬‹ã€‚';
                tetherLogic = 'åœ¨ç›®æ ‡å†…åœˆ<span class="purple">å³ä¾§</span>è´´è¾¹å¤„ç†<span class="purple">è¿œç‚¹å</span>ã€‚';
            } else if (t === 'æš—') {
                mech = 'ç«™åœ¨å¡”å†…å‘åœºå¤–å¼•å¯¼æ¿€å…‰ï¼Œèº²é¿çŸ³ç¬‹ã€‚';
                tetherLogic = 'å‰å¾€ç›®æ ‡å†…åœˆ<span class="purple">ä¸­é—´</span>å¤„ç†<span class="purple">è¿‘ç‚¹å</span>ã€‚';
            } else if (t === 'åœŸ') {
                mech = 'ç¦»å¼€åŸåœ°ï¼ˆå»æ²¡å¡”çš„åœ°æ–¹ï¼‰ï¼Œèº²é¿çŸ³ç¬‹ã€‚';
                tetherLogic = 'å¤„ç†é—²äººå¼•å¯¼ã€‚';
            } else if (t === 'ç«') {
                mech = 'ä¸åŠ¨ï¼Œç­‰çƒ­ç—…buffè§£é™¤ã€‚';
                tetherLogic = 'å¤„ç†é—²äººå¼•å¯¼ã€‚';
            }
            return `<span class="font-bold">${mech}</span><br>éšåï¼š${tetherLogic}`;
        }

        function getQ6Answer(s) {
            const aType = s.initialAdds.id;
            const jump = s.secondAddJump.id;
            let safeSpot = '';
            if (aType === 'A_LR_C_UD') {
                if (jump === 'SuckA_JumpB') safeSpot = 'Bç‚¹å†…ä¾§';
                else if (jump === 'SuckA_JumpD') safeSpot = 'Dç‚¹å†…ä¾§';
                else if (jump === 'SuckC_JumpB') safeSpot = 'Bç‚¹å·¦å³';
                else if (jump === 'SuckC_JumpD') safeSpot = 'Dç‚¹å·¦å³';
            } else { 
                if (jump === 'SuckA_JumpB') safeSpot = 'Bç‚¹å·¦å³';
                else if (jump === 'SuckA_JumpD') safeSpot = 'Dç‚¹å·¦å³';
                else if (jump === 'SuckC_JumpB') safeSpot = 'Bç‚¹å†…ä¾§';
                else if (jump === 'SuckC_JumpD') safeSpot = 'Dç‚¹å†…ä¾§';
            }
            return `è®°ä½ï¼šç¨åçš„å®‰å…¨åŒºåœ¨ <span class="highlight">${safeSpot}</span>`;
        }

        function getQ7Answer(s) {
            if (s.shadowOrder.id === 'card_first') {
                return 'åŒTå» <span class="highlight">C</span>ï¼Œè¿œç¨‹ç»„å» <span class="highlight">B</span>ï¼Œè¿‘æˆ˜å» <span class="highlight">2</span>';
            } else {
                return 'åŒTå» <span class="highlight">3</span>ï¼Œè¿œç¨‹ç»„å» <span class="highlight">2</span>ï¼Œè¿‘æˆ˜å» <span class="highlight">C</span>';
            }
        }

        function getQ8Answer(s) {
            const aType = s.initialAdds.id;
            const jump = s.secondAddJump.id;
            if (aType === 'A_LR_C_UD') {
                if (jump === 'SuckA_JumpB') return 'Bå†…å®‰å…¨';
                if (jump === 'SuckA_JumpD') return 'Då†…å®‰å…¨';
                if (jump === 'SuckC_JumpB') return 'Bå·¦å³å®‰å…¨';
                if (jump === 'SuckC_JumpD') return 'Då·¦å³å®‰å…¨';
            } else { 
                if (jump === 'SuckA_JumpB') return 'Bå·¦å³å®‰å…¨';
                if (jump === 'SuckA_JumpD') return 'Då·¦å³å®‰å…¨';
                if (jump === 'SuckC_JumpB') return 'Bå†…å®‰å…¨';
                if (jump === 'SuckC_JumpD') return 'Då†…å®‰å…¨';
            }
        }

        function getQ9Answer(s) {
            if (s.shadowOrder.id === 'card_first') {
                return 'åŒTå» <span class="highlight">3</span>ï¼Œè¿œç¨‹ç»„å» <span class="highlight">2</span>ï¼Œè¿‘æˆ˜å» <span class="highlight">C</span>';
            } else {
                return 'åŒTå» <span class="highlight">C</span>ï¼Œè¿œç¨‹ç»„å» <span class="highlight">B</span>ï¼Œè¿‘æˆ˜å» <span class="highlight">2</span>';
            }
        }

        function getQ10Answer(s) {
             const aType = s.initialAdds.id; 
             const jump = s.secondAddJump.id;
             if (aType === 'A_LR_C_UD') {
                 if (jump.startsWith('SuckA')) return 'BOSSè„šåº• (æ­£ä¸­é—´)';
                 return 'B/Dæ ‡ç‚¹å¤–ä¾§';
             } else {
                 if (jump.startsWith('SuckA')) return 'B/Dæ ‡ç‚¹å¤–ä¾§';
                 return 'BOSSè„šåº• (æ­£ä¸­é—´)';
             }
        }


        // --- æ¸²æŸ“é€»è¾‘ ---

        function render() {
            const app = document.getElementById('app');
            let content = '';
            
            // æ˜¯å¦æ˜¯é™æ—¶æ¨¡å¼
            const isTimeAttack = state.mode === 'timeAttack';

            if (state.step === 0) {
                // å°é¢
                content = `
                    <div class="card p-8 text-center fade-in">
                        <div class="mb-6 rounded-xl overflow-hidden shadow-lg border border-gray-200">
                           <div class="w-full h-48 bg-gray-100 flex items-center justify-center relative">
                                <img src="cover.jpeg" alt="Cover" class="w-full h-full object-cover" onerror="this.parentElement.innerText='å°é¢å›¾: cover.jpeg'">
                           </div>
                        </div>
                        <h1 class="text-3xl font-bold mb-2 tracking-tight">M12Så››è¿æ¨¡æ‹Ÿå™¨</h1>
                        <p class="text-gray-500 mb-6 font-medium">æœ¬æ¨¡æ‹Ÿå™¨é€‚é…CCHHç‰¹åŒ–æ‰“æ³•ï¼ˆBROæ”¹ï¼‰</p>
                        
                        <div class="space-y-3 mb-4">
                            <button class="btn shadow-lg shadow-blue-500/30" onclick="initScenario('practice')">ç»ƒä¹ æ¨¡å¼</button>
                            <button class="btn bg-orange-500 hover:bg-orange-600 shadow-lg shadow-orange-500/30" onclick="initScenario('timeAttack')">
                                é™æ—¶æ¨¡å¼
                            </button>
                            <button class="btn btn-outline" onclick="showNotes()">é˜²çŒªç¬”è®°</button>
                        </div>
                        <div class="copyright">Design by å‘èŠ½é»’ä¸ç‚¹</div>
                    </div>
                `;
            } else if (state.step === -1) {
                // å¤ä¹ ç¬”è®°é¡µé¢
                content = `
                     <div class="card p-6 fade-in h-full">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">é˜²çŒªç¬”è®°</h2>
                            <button class="text-sm text-blue-600 font-medium" onclick="restart()">è¿”å›</button>
                        </div>
                        <div class="overflow-y-auto max-h-[60vh] pr-2">
                            <div class="note-card">
                                <h3 class="font-bold text-gray-800 mb-2">æ¥çº¿é˜²çŒªå®</h3>
                                <p class="text-gray-500 text-sm">Aç‚¹è¿çº¿<br>/e æ¥Aé¡º1åœˆ<br>/e 1ç‚¹å¤§åœˆâ†’2ç‚¹åˆ†æ‘Š<br><br>1ç‚¹è¿çº¿<br>/e æ¥Aé¡º2åœˆ<br>/e 2ç‚¹åˆ†æ‘Šâ†’1ç‚¹å¤§åœˆ<br><br>Bç‚¹è¿çº¿<br>/e æ¥Aé¡º1æ‘Š<br>/e 2ç‚¹åˆ†æ‘Šâ†’2ç‚¹åˆ†æ‘Š<br><br>2ç‚¹è¿çº¿<br>/e æ¥Aé¡º2æ‘Š<br>/e 2ç‚¹åˆ†æ‘Šâ†’2ç‚¹åˆ†æ‘Š<br><br>Cç‚¹è¿çº¿<br>/e æ¥Cé¡º1æ‘Š<br>/e 3ç‚¹åˆ†æ‘Šâ†’3ç‚¹åˆ†æ‘Š<br><br>3ç‚¹è¿çº¿<br>/e æ¥Cé¡º2æ‘Š<br>/e 3ç‚¹åˆ†æ‘Šâ†’3ç‚¹åˆ†æ‘Š<br><br>Dç‚¹è¿çº¿<br>/e æ¥Cé¡º1åœˆ<br>/e 4ç‚¹å¤§åœˆâ†’3ç‚¹åˆ†æ‘Š<br><br>4ç‚¹è¿çº¿<br>/e æ¥Cé¡º2åœˆ<br>/e 3ç‚¹åˆ†æ‘Šâ†’4ç‚¹å¤§åœˆ</p>
                            </div>
                            <div class="note-card">
                                <h3 class="font-bold text-gray-800 mb-2">æ­£æ–œåˆ†èº«</h3>
                                <p class="text-gray-500 text-sm">/p â€”â€”â€”â€”â€”æ­£ç‚¹åˆ†èº«â€”â€”â€”â€”â€”<br>/p å›æº¯1ï¼šåŒTå»Cï¼Œè¿œç¨‹ç»„Bï¼Œè¿‘æˆ˜2<br>/p å›æº¯2ï¼šåŒTå»3ï¼Œè¿œç¨‹ç»„2ï¼Œè¿‘æˆ˜C<br>/p â€”â€”â€”â€”â€”æ–œç‚¹åˆ†èº«â€”â€”â€”â€”â€”<br>/p å›æº¯1ï¼šåŒTå»3ï¼Œè¿œç¨‹ç»„2ï¼Œè¿‘æˆ˜C<br>/p å›æº¯2ï¼šåŒTå»Cï¼Œè¿œç¨‹ç»„Bï¼Œè¿‘æˆ˜2</p>
                            </div>
                            <div class="note-card">
                                <h3 class="font-bold text-gray-800 mb-2">åˆ†èº«å®‰å…¨åŒº</h3>
                                <p class="text-gray-500 text-sm">/p Aæ‰“å‰åï¼ŒCæ‰“å·¦å³ï¼Œ14å®‰å…¨<br>/p Aæ‰“å·¦å³ï¼ŒCæ‰“å‰åï¼Œ23å¤–å®‰å…¨</p>
                            </div>
                             <div class="note-card">
                                <h3 class="font-bold text-gray-800 mb-2">è¸©å¡”é˜²çŒªå®</h3>
                                <p class="text-gray-500 text-sm">/e æˆ‘æ˜¯æš—ï¼Œè¿‘buff<br> /e æˆ‘æ˜¯é£ï¼Œè¿œbuff<br> /e è¦æ¢å¡”</p>
                            </div>
                             <div class="note-card">
                                <h3 class="font-bold text-gray-800 mb-2">é»‘æ´è·³è·ƒé€Ÿè®°</h3>
                                <p class="text-gray-500 text-sm">/p å·¦å³å®‰å…¨â†’BDå®‰å…¨<br>/p å†…å®‰å…¨â†’åœºæ­£ä¸­å®‰å…¨</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.step === 99) {
                // é™æ—¶æ¨¡å¼ - å›¢ç­
                content = `
                    <div class="card p-8 text-center fade-in border-red-200">
                        <h2 class="text-3xl font-bold mb-4 text-red-600">æ­»äº†å•¦ï¼</h2>
                        <div class="mb-6 flex justify-center">
                             <div class="text-6xl">ğŸ·</div>
                        </div>
                        <p class="text-gray-600 mb-8 font-medium">çŠ¹è±«å°±ä¼šçˆ†ç‚¸ã€‚<br>å‡ºé—¨ä¸¥è‚ƒå­¦ä¹ æ–‡æ¡£ï¼</p>
                        <button class="btn bg-gray-800 hover:bg-gray-900" onclick="restart()">ä¸æ˜¯å¾ˆæœ</button>
                    </div>
                `;
            } else if (state.step === 11) {
                // ç»“æŸ
                content = `
                    <div class="card p-8 text-center fade-in">
                        <h2 class="text-2xl font-bold mb-4">ä¸­ï¼ä¿ºæ˜¯é«˜æ‰‹ï¼ˆå—ï¼‰</h2>
                        <div class="mb-6 flex justify-center">
                            <img src="pig.gif" alt="Success" class="w-32 h-32 object-contain" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Pig.png'">
                        </div>
                        <p class="text-gray-600 mb-8">æœºåˆ¶æ˜¯ç¢çš„ï¼Œæ”»ç•¥æ˜¯ç¢çš„ï¼Œæˆ‘çš„è„‘å­ä¹Ÿæ˜¯ç¢çš„</p>
                        <button class="btn" onclick="restart()">é©¬å†¬æ¢…ï¼Ÿå†æ¥ä¸€å±€</button>
                    </div>
                `;
            } else {
                // æ¨¡æ‹Ÿè¿›è¡Œä¸­
                const s = state.scenario;
                let qTitle = '', qContext = '', qText = '', aText = '';
                
                // é€šç”¨è§’è‰²æ ‡ç­¾
                const roleBadge = `<span class="inline-flex items-center bg-gray-900 text-white px-2.5 py-1 rounded-md text-sm font-bold mr-2 shadow-sm">æˆ‘æ˜¯ ${s.role}</span>`;
                
                // çŠ¶æ€æœº
                switch(state.step) {
                    case 1:
                        qTitle = "1. å½±å­ä¸æ¥çº¿";
                        // é˜¶æ®µ1ï¼šé™æ—¶æ¨¡å¼ä¹Ÿæ˜¾ç¤ºæç¤º
                        qContext = `
                            <div class="info-box">
                                <p class="mb-1"><span class="text-gray-500">å½±å­åˆ·æ–°:</span> <span class="font-medium">${s.shadowOrder.text}</span></p>
                                <p class="mb-1"><span class="text-gray-500">å°æ€ªç‚¹å:</span> <span class="font-medium">${s.tetherType.text}</span></p>
                                <p><span class="text-gray-500">æˆ‘çš„è¿çº¿:</span> <span class="font-bold text-blue-600">å½±å­ ${s.role}</span></p>
                            </div>
                        `;
                        qText = `${roleBadge} ç»“åˆå½±å­é¡ºåºå’Œç‚¹åç±»å‹ï¼Œä½ éœ€è¦å»æ¥å“ªæ ¹çº¿ï¼Ÿ`;
                        aText = getQ1Answer(s);
                        break;
                    case 2:
                        qTitle = "2. å¤„ç†ä¸Šä¸‹å·¦å³åˆ€";
                        // é˜¶æ®µ2ï¼šé™æ—¶æ¨¡å¼ä¹Ÿæ˜¾ç¤ºæç¤º
                        qContext = `
                            <div class="info-box">
                                <p><span class="text-gray-500">åˆå§‹é¢„å…†:</span> <span class="font-bold">${s.initialAdds.text}</span></p>
                            </div>
                        `;
                        qText = "æ¥çº¿é”å®šåï¼Œä½ éœ€è¦å»å“ªé‡Œèº²é¿ï¼Ÿ";
                        aText = getQ2Answer(s);
                        break;
                    case 3:
                        qTitle = "3. åœ£é¤ä¸å¡”é¢„å…†";
                        // é˜¶æ®µ3ï¼šé™æ—¶æ¨¡å¼ä¹Ÿæ˜¾ç¤ºæç¤º
                        qContext = `
                            <div class="info-box border-l-4 border-yellow-400">
                                <p class="text-sm text-gray-400 uppercase tracking-wide mb-2">é¢„å…†å‡ºç°</p>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div>
                                        <div class="text-gray-500">ä½ çš„åˆå§‹ä½ç½®</div>
                                        <div class="font-bold text-lg">${s.tower.myInit}å¡”</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-500">éš”å£é˜Ÿå‹</div>
                                        <div class="font-bold text-lg">${s.tower.neighbor}å¡”</div>
                                    </div>
                                </div>
                                <div class="mt-3 pt-3 border-t border-gray-200">
                                    <span class="text-gray-500">ä½ çš„çŠ¶æ€:</span> 
                                    ${s.tower.hasDebuff ? '<span class="danger bg-red-50 px-2 py-0.5 rounded">æœ‰ç‚¹å (Debuff)</span>' : '<span class="text-gray-600">æ— ç‚¹å</span>'}
                                </div>
                            </div>
                        `;
                        qText = "æ ¹æ®ä½ çš„ä½ç½®å’Œç‚¹åçŠ¶æ€ï¼Œç¨åå¤„ç†å¡”æ—¶éœ€è¦æ€ä¹ˆå¤„ç†ï¼Ÿ";
                        aText = getQ3Answer(s);
                        break;
                    case 4:
                        qTitle = "4. å¤„ç†è¿çº¿ç‚¹å";
                        // é˜¶æ®µ4ï¼šé™æ—¶æ¨¡å¼éšè—æç¤º
                        if (!isTimeAttack) {
                            qContext = `
                                <div class="info-box">
                                    <p class="text-gray-500 text-sm">åˆ‡æ¢å›åˆå§‹åœºåœ°...</p>
                                </div>
                            `;
                        }
                        qText = `${roleBadge} ä½ éœ€è¦æŒ‰ä»€ä¹ˆé¡ºåºå¤„ç†å°æ€ªç‚¹åï¼Ÿ`;
                        aText = getQ4Answer(s);
                        break;
                    case 5:
                        qTitle = "5. å¡”æœºåˆ¶ä¸è¿œè¿‘çº¿";
                        // é˜¶æ®µ5ï¼šé™æ—¶æ¨¡å¼éšè—æç¤º
                        if (!isTimeAttack) {
                            qContext = `
                                <div class="info-box">
                                    <p class="text-gray-500 text-sm">åˆ‡æ¢åˆ°å°ä¸–ç•Œ...</p>
                                    <p class="text-sm font-medium mt-1">ä½ æœ€ç»ˆå¤„ç† <span class="highlight">${s.tower.final}å¡”</span></p>
                                </div>
                            `;
                        }
                        qText = "è¯·æè¿°å¡”åŠåç»­å°ä¸–ç•Œæœºåˆ¶çš„å¤„ç†æ–¹å¼ã€‚";
                        aText = getQ5Answer(s);
                        break;
                    case 6:
                        qTitle = "6. è®°å¿†åˆ†èº«è·³è·ƒ";
                        // é˜¶æ®µ6ï¼šé™æ—¶æ¨¡å¼åªå±•ç¤º Jump æç¤º
                        if (isTimeAttack) {
                             qContext = `
                                <div class="info-box border-l-4 border-purple-400">
                                    <p class="text-sm text-gray-400 uppercase tracking-wide mb-2">é¢„å…†å‡ºç°</p>
                                    <p class="mt-1"><span class="text-gray-500">é»‘æ´è·³è·ƒ:</span> <span class="danger text-lg">${s.secondAddJump.text}</span></p>
                                </div>
                            `;
                        } else {
                            qContext = `
                                <div class="info-box border-l-4 border-purple-400">
                                    <p class="text-sm text-gray-400 uppercase tracking-wide mb-2">é¢„å…†å‡ºç°</p>
                                    <p><span class="text-gray-500">åˆå§‹å°æ€ª:</span> <span class="font-medium">${s.initialAdds.text}</span></p>
                                    <p class="mt-1"><span class="text-gray-500">é»‘æ´è·³è·ƒ:</span> <span class="danger text-lg">${s.secondAddJump.text}</span></p>
                                </div>
                            `;
                        }
                        qText = "ç¨åç¬¬ä¸€æ¬¡ç»“ç®—çš„å®‰å…¨åŒºåœ¨å“ªé‡Œï¼Ÿ";
                        aText = getQ6Answer(s);
                        break;
                    case 7:
                        qTitle = "7. ç¬¬ä¸€æ¬¡åˆ†æ‘Š/å¤§åœˆ";
                        // é˜¶æ®µ7ï¼šé™æ—¶æ¨¡å¼éšè—æç¤º
                        if (!isTimeAttack) {
                            qContext = `
                                <div class="info-box">
                                    <p class="text-gray-500 text-sm">å½±å­é¡ºåºå›é¡¾ï¼š${s.shadowOrder.text}</p>
                                </div>
                            `;
                        }
                        qText = "ç¬¬ä¸€è½®å½±å­ç»“ç®—ã€‚å»å“ªé‡Œå¤„ç†ï¼Ÿ";
                        aText = getQ7Answer(s);
                        break;
                    case 8:
                        qTitle = "8. ç¬¬ä¸€æ¬¡åœºåœ°å®‰å…¨åŒº";
                        // é˜¶æ®µ8ï¼šé™æ—¶æ¨¡å¼éšè—æç¤º
                        if (!isTimeAttack) {
                            qContext = `
                                <div class="info-box">
                                    <p class="text-gray-500 text-sm">åˆ‡æ¢åˆ°å°ä¸–ç•Œ...</p>
                                </div>
                            `;
                        }
                        qText = "å‰å¾€åˆšæ‰è®°å¿†çš„å®‰å…¨åŒºã€‚æ˜¯å“ªé‡Œï¼Ÿ";
                        aText = getQ8Answer(s);
                        break;
                    case 9:
                        qTitle = "9. ç¬¬äºŒæ¬¡åˆ†æ‘Š/å¤§åœˆ";
                        // é˜¶æ®µ9ï¼šé™æ—¶æ¨¡å¼éšè—æç¤º
                        if (!isTimeAttack) {
                            qContext = `
                                <div class="info-box">
                                    <p class="text-gray-500 text-sm">å½±å­é¡ºåºå›é¡¾ï¼š${s.shadowOrder.text}</p>
                                </div>
                            `;
                        }
                        qText = "ç¬¬äºŒè½®å½±å­ç»“ç®—ã€‚å»å“ªé‡Œå¤„ç†ï¼Ÿ";
                        aText = getQ9Answer(s);
                        break;
                    case 10:
                        qTitle = "10. ç¬¬äºŒæ¬¡åœºåœ°å®‰å…¨åŒº";
                        // é˜¶æ®µ10ï¼šé™æ—¶æ¨¡å¼éšè—æç¤º
                        if (!isTimeAttack) {
                            qContext = `
                                <div class="info-box">
                                    <p class="text-gray-500 text-sm">åˆ‡æ¢å›åˆè¯†åœºåœ°...</p>
                                </div>
                            `;
                        }
                        qText = "æœ€åçš„å®‰å…¨åŒºåœ¨å“ªé‡Œï¼Ÿ";
                        aText = getQ10Answer(s);
                        break;
                }

                content = `
                    <div class="card p-6 fade-in relative overflow-hidden">
                        ${isTimeAttack ? `<span class="absolute top-4 right-4 text-xs font-bold text-orange-500 border border-orange-200 bg-orange-50 px-2 py-1 rounded">é™æ—¶æ¨¡å¼</span>` : ''}
                        
                        <div class="phase-indicator bg-blue-500 absolute top-0 left-0" style="width: ${(state.step / 10) * 100}%"></div>
                        
                        <div class="flex justify-between items-center mb-6 mt-2">
                            <h2 class="text-xl font-bold tracking-tight">${qTitle}</h2>
                            <span class="text-xs font-medium text-gray-400 bg-gray-100 px-2 py-1 rounded-full">${state.step}/10</span>
                        </div>

                        ${qContext}

                        <div class="mb-8">
                            <p class="text-lg font-bold mb-2 text-gray-900">â“ æ€è€ƒ</p>
                            <p class="text-gray-700 leading-relaxed">${qText}</p>
                        </div>

                        ${state.showAnswer ? `
                            <div class="bg-green-50 border border-green-100 p-5 rounded-xl mb-6 fade-in shadow-inner">
                                <div class="flex items-center mb-2">
                                    <div class="w-5 h-5 rounded-full bg-green-500 flex items-center justify-center text-white text-xs font-bold mr-2">âœ“</div>
                                    <p class="text-sm text-green-800 font-bold">æ­£ç¡®ç­”æ¡ˆ</p>
                                </div>
                                <div class="text-gray-800 leading-relaxed pl-7">${aText}</div>
                            </div>
                            <button class="btn" onclick="nextStep()">
                                ${isTimeAttack ? '<div class="timer-bar timer-5s"></div>' : ''}
                                ${state.step === 10 ? 'å®Œæˆæ¼”ç»ƒ' : (isTimeAttack ? 'ä¸‹ä¸€é¢˜ (è‡ªåŠ¨)' : 'ä¸‹ä¸€é¢˜')}
                            </button>
                        ` : `
                            <button class="btn btn-secondary ${isTimeAttack ? 'text-blue-600 bg-blue-50 hover:bg-blue-100' : ''}" onclick="toggleAnswer()">
                                ${isTimeAttack ? '<div class="timer-bar timer-10s"></div>' : ''}
                                æŸ¥çœ‹ç­”æ¡ˆ
                            </button>
                        `}
                    </div>
                `;
            }

            app.innerHTML = content;
        }

        render();

    </script>
</body>
</html>
